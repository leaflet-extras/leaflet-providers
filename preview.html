<!doctype html>
<html lang="en">
<head>
	<title>Leaflet Provider Demo</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- Leaflet style. REQUIRED! -->
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.css" />
	<!--[if lte IE 8]>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.ie.css" />
	<![endif]-->
	<style>
		html { height: 100% }
		body { height: 100%; margin: 0; padding: 0;}
		.map{ height: 100% }

		.leaflet-providers-control {
			padding: 6px;
		}
		.leaflet-providers-control textarea {
			font-size: 10px;
			border: 0; outline: 0;
			width: 600px;
			height: 140px;
			font-family: monospace;
			white-space: pre;
		}
		.info {
			margin-left: 150px !important;
			width: 500px;
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}
	</style>
	<!--Fork Me on Github ribbon, we're using the awsome version from simonwhitaker available at https://github.com/simonwhitaker/github-fork-ribbon-css  -->
	<link rel="stylesheet" href="css/gh-fork-ribbon.css" />
	<!--[if IE]>
		<link rel="stylesheet" href="css/gh-fork-ribbon.ie.css" />
	<![endif]-->
</head>
<body>
	<div class="github-fork-ribbon-wrapper left">
		<div class="github-fork-ribbon">
			<a href="https://github.com/leaflet-extras/leaflet-providers">Fork me on GitHub</a>
		</div>
	</div>
	<div id="map" class="map"></div>
	<script src="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet-src.js"></script>
	<script src="leaflet-providers.js"></script>
	<script>
	var map = new L.Map('map', {
		zoomControl: false,
		center: [48, -3],
		zoom: 5
	});

	// save the options object while creating tilelayers to cleanly access it later.
	var origTileLayerInit = L.TileLayer.prototype.initialize;
	L.TileLayer.include({
		initialize: function (url, options) {
			this._options = options;
			origTileLayerInit.apply(this, arguments);
		}
	});
	var origProviderInit = L.TileLayer.Provider.prototype.initialize;
	L.TileLayer.Provider.include({
		initialize: function (arg, options) {
			this._providerName = arg;
			origProviderInit.apply(this, arguments);
		}
	})

	// Define the names of the layers that should be inserted in the control as
	// an overlay.
	var isOverlay = function (layer) {
		if (layer.match(/^(OpenWeatherMap|OpenSeaMap)/)){
			return true;
		}
	}

	// collect all layers available in the provider definition
	var baselayers = {};
	var overlays = {};
	var addLayer = function (name) {
		if (isOverlay(name)) {
			overlays[name] = L.tileLayer.provider(name);
		} else {
			baselayers[name] = L.tileLayer.provider(name);
		}
	}
	for (var provider in L.TileLayer.Provider.providers) {
		if (L.TileLayer.Provider.providers[provider].variants) {
			for (var variant in L.TileLayer.Provider.providers[provider].variants) {
				addLayer(provider + '.' + variant);
			}
		} else {
			addLayer(provider);
		}
	}
	L.control.layers(baselayers, overlays, {collapsed: false}).addTo(map);
	baselayers['OpenStreetMap.Mapnik'].addTo(map);

	// Add the TileLayer source code control to the map
	map.addControl(new (L.Control.extend({
		options: {
			position: 'bottomleft'
		},
		onAdd: function (map) {
			var container = L.DomUtil.create('div', 'leaflet-control leaflet-control-layers leaflet-providers-control');
			L.DomEvent.disableClickPropagation(container);
			container.innerHTML = '<strong>Copy to create your TileLayer:</strong><br />';
			var code = L.DomUtil.create('textarea', 'code', container);

			var update = function (event) {
				code.innerHTML = '';

				// loop over the layers in the map and add the JS
				for (var key in map._layers) {
					var layer = map._layers[key];

					var layerName = layer._providerName.replace('.', '_');

					// do not add the layer currently being removed
					if (event && event.type == 'layerremove' && layer === event.layer) {
						continue;
					}
					var tileLayerCode = 'var ' + layerName + ' = L.tileLayer("' + layer._url + '", {\n';

					var options = layer._options;
					var first = true;
					for (var option in options) {
						if (first) {
							first = false;
						} else {
							tileLayerCode += ',\n';
						}
						tileLayerCode += "  " + option + ": ";
						if (typeof options[option] === 'string') {
							var string = options[option]
								.replace(/&/g, "&amp;")
								.replace(/</g, "&lt;")
								.replace(/>/g, "&gt;")
								.replace(/"/g, "&quot;")
								.replace(/'/g, "&#039;");
							tileLayerCode += "'" + string + "'";
						} else {
							tileLayerCode += options[option];
						}
					}
					tileLayerCode += '\n});\n\n';
					code.innerHTML += tileLayerCode;
				}
			};

			map.on({
				'layeradd': update,
				'layerremove': update
			});
			update();

			return container;
		}
	}))());
	map.addControl(new (L.Control.extend({
		options: {
			position: 'topleft'
		},
		onAdd: function (map) {
			var div = L.DomUtil.create('div', 'info');
			div.innerHTML =
				'<h4><a href="https://github.com/leaflet-extras/leaflet-providers">Leaflet-providers preview</a></h4>' +
				'This page shows all the layers available in ' +
				'<a href="https://github.com/leaflet-extras/leaflet-providers">Leaflet-providers</a> ' +
				'in the layer control on the right. After selecting a layer, the source box in the bottom left corner ' +
				'shows the JS code required to include that layer in your own code.';
			return div;
		}
	}))());

	// resize control to fit into view.
	var layerControlHeight = document.body.clientHeight - (10 + 50);
	var layerControl = document.getElementsByClassName('leaflet-control-layers-expanded')[0];

	layerControl.style.overflowY = 'auto';
	layerControl.style.maxHeight = layerControlHeight + 'px';

	</script>
</body>
</html>
